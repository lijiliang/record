# nginx

## 几个概念

### 反向代理
- 服务器集群，不希望直接对外暴露，因此设置了一层代理服务器；
- 从个人电脑访问该服务器集群提供的服务时，直接访问的是代理服务器，然后代理服务器从源服务器获取到资源再返回给个人电脑；
- 从客户端角度来看，中间层代理服务器是透明的，客户端无感知，客户端不需要做任何配置就可以，认为自己就是从源服务器取得数据。

- 反向代理 被代理的是 服务器

### 正向代理
- 有反向代理就有正向代理。
- 正向代理的场景是，在公司内网，不希望无限制的访问外网资源，因此也设置了一层代理服务器。
- 从个人电脑请求访问资源的时候，客户端向代理发送一个请求，并指定目标资源的路径，然后代理服务器转发请求到源服务器，获取数据之后转发给客户端。
- 从源服务器角度来看，中间代理服务器是透明的，源服务器认为是客户端直接访问的自己。
- 需要注意的是，正向代理必须要在客户端做响应的配置。

- 正向代理 被代理的是 客户端

## 负载均衡
负载均衡是用来协助更好的实现反向代理的。

使用反向代理，服务器集群响应请求的分配策略就是负载均衡策略。不能说某些源服务器承担过多的请求处理任务，而同时另一些源服务器却是闲置状态。
利用复杂均衡策略，可以使请求分发到合适的服务器上，以达到最快的响应速度。

## Nginx
nginx 是一个高性能的web服务器和反向代理服务器

## 安装
```
brew install nginx
nginx -v # 查看是否安装成功
# nginx 主配置文件
cd /usr/local/etc/nginx/nginx.conf

```

## 常用命令
```
nginx -h # 查看命令帮助
nginx # 启动nginx
nginx -s stop # 快速停止nginx服务
nginx -s quit # 完整有序的停止nginx服务
nginx -s reload # 修改配置后重新加载nginx服务生效
nginx -s reopen # 重新打开日志文件
nginx -t # 验证配置文件是否正确
```

## nginx.conf 常用配置
```
http {
  # 负载均衡
  upstream lb {
    ip_hash # 记录客户端第一次访问时的响应服务器，后续全部分配该服务器响应
    server 10.10.10.10 # 源服务器1
    server 20.20.20.20 # 源服务器2
    ...
  }
  # 反向代理
  server {
    listen 80
    location / {
      proxy_pass http://目标服务器ip:port
    }
  }
  server {
    listen 8081
    location / {
      proxy_pass http://lb
    }
  }
}
```

## TODO
- 访问某些服务器被拒绝，需要配置host
- nginx 模块设置引入机制

## 知识点

- web 服务器： 存储、处理和传递网页， 使用HTTP协议，传递的一般是 HTML页面（css、js、image）
- web应用程序服务器：高负载，企业业务处理